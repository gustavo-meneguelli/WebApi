services:
  # ---------------------------------------------------------------------------------------
  # WEB SERVICE (API)
  # ---------------------------------------------------------------------------------------
  - type: web
    name: darklyn-api
    env: docker
    plan: free
    region: oregon
    healthCheckPath: /health
    
    # Environment Variables
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      
      # Force .NET to listen on port 8080 (matches Dockerfile EXPOSE)
      - key: ASPNETCORE_URLS
        value: http://+:8080

      # Database Connection (Auto-injected by Render)
      - key: DATABASE_URL
        fromDatabase:
          name: darklyn-db
          property: connectionString

      # JWT Settings (Securely generated)
      - key: JwtSettings__SecretKey
        generateValue: true
      - key: JwtSettings__Issuer
        value: darklyn-tech-store-api
      - key: JwtSettings__Audience
        value: darklyn-tech-store-users

databases:
  # ---------------------------------------------------------------------------------------
  # POSTGRESQL DATABASE
  # ---------------------------------------------------------------------------------------
  - name: darklyn-db
    databaseName: darklyn_store
    user: darklyn_user
    plan: free # Free Tier (expires in 90 days if redundant, spun down on inactivity)
    region: oregon
    ipAllowList: [] # Allow all IPs (for outside access if needed) or restrict
